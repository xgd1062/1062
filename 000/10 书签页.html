<!DOCTYPE html>
<html lang="zh-CN">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Bookmark Pro - ä¹¦ç­¾ç®¡ç†å·¥å…·</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    .bookmark-card {
      transition: transform .2s ease, box-shadow .2s ease;
      position: relative;
      padding: 1.5rem;
      border-radius: 1rem;
      background: white;
      border: 1px solid #eee;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
      min-width: 280px;
      max-width: 100%;
      height: 200px;
      display: flex;
      flex-direction: column;
      justify-content: space-between;
    }

    .bookmark-card:hover {
      transform: translateY(-3px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08)
    }

    html {
      scroll-behavior: smooth
    }

    .input-error {
      border-color: #ef4444 !important
    }

    .error-message {
      color: #ef4444;
      font-size: .875rem;
      margin-top: .25rem;
      display: none
    }

    .loader {
      border-top-color: #3b82f6;
      animation: spinner .6s linear infinite
    }

    @keyframes spinner {
      0% {
        transform: rotate(0deg)
      }

      100% {
        transform: rotate(360deg)
      }
    }

    header {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      z-index: 50;
      background-color: white;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .header-container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1rem 1.5rem;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 1rem;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: .5rem;
    }

    .logo-icon {
      font-size: 1.8rem;
      color: #3b82f6;
    }

    .logo-text {
      font-size: 1.5rem;
      font-weight: 600;
      color: #111827;
      margin: 0;
    }

    .nav-buttons {
      display: flex;
      align-items: center;
      gap: .75rem;
    }

    .nav-btn {
      display: flex;
      align-items: center;
      gap: .5rem;
      padding: .6rem 1.2rem;
      border-radius: .5rem;
      border: none;
      cursor: pointer;
      font-size: .9rem;
      transition: all .2s ease;
    }

    .import-edge-btn,
    .export-edge-btn {
      background-color: #f3f4f6;
      color: #374151;
    }

    .sync-github-btn {
      background-color: #10b981;
      color: white;
    }

    .sync-github-btn:hover {
      background-color: #059669;
    }

    .sync-github-btn.loading {
      opacity: 0.8;
      cursor: not-allowed;
    }

    .add-btn {
      background-color: #3b82f6;
      color: white;
    }

    .import-edge-btn:hover,
    .export-edge-btn:hover {
      background-color: #e5e7eb;
    }

    .add-btn:hover {
      background-color: #2563eb;
    }

    .category-tabs-container {
      position: sticky;
      top: 64px;
      z-index: 40;
      background-color: rgb(249 250 251);
      padding: 1rem 1.5rem;
      margin: 0 auto;
      max-width: 1170px;
      border-radius: 1rem;
      margin-top: 74px;
      display: flex;
      align-items: center;
      gap: .75rem;
      overflow-x: auto;
      scrollbar-width: thin;
      scrollbar-color: #d1d5db transparent;
      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    }

    .category-tabs-container::-webkit-scrollbar {
      height: 6px;
    }

    .category-tabs-container::-webkit-scrollbar-thumb {
      background-color: #d1d5db;
      border-radius: 3px;
    }

    .category-tabs-container::-webkit-scrollbar-track {
      background-color: transparent;
    }

    .category-tab {
      flex-shrink: 0;
      padding: .6rem 1.2rem;
      border-radius: 9999px;
      background-color: #e5e7eb;
      color: #374151;
      border: none;
      cursor: pointer;
      font-size: .95rem;
      transition: all .2s ease;
      position: relative;
    }

    .category-tab.active {
      background-color: #3b82f6;
      color: white;
    }

    .category-tab:hover:not(.active) {
      background-color: #d1d5db;
    }

    .add-category-btn {
      flex-shrink: 0;
      padding: .6rem 1.2rem;
      border-radius: 9999px;
      background-color: #f3f4f6;
      color: #374151;
      border: none;
      cursor: pointer;
      font-size: .95rem;
      transition: all .2s ease;
      display: flex;
      align-items: center;
      gap: .5rem;
      margin-left: auto;
    }

    .add-category-btn:hover {
      background-color: #e5e7eb;
    }

    .category-delete-btn {
      position: absolute;
      top: -8px;
      right: -8px;
      width: 20px;
      height: 20px;
      border-radius: 50%;
      background-color: #ef4444;
      color: white;
      border: none;
      cursor: pointer;
      font-size: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity .2s ease;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
      z-index: 10;
      pointer-events: auto;
    }

    .category-tab:hover .category-delete-btn {
      opacity: 1;
    }

    .main-content {
      max-width: 1200px;
      margin: 0 auto;
      padding: 1.5rem;
      padding-top: 1rem;
      flex: 1;
    }

    #bookmarks-grid {
      display: grid;
      grid-template-columns: 1fr;
      gap: 1.5rem;
    }

    @media (min-width: 640px) {
      #bookmarks-grid {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    @media (min-width: 1024px) {
      #bookmarks-grid {
        grid-template-columns: repeat(4, 1fr);
      }
    }

    .btn-primary {
      background-color: #3b82f6 !important;
      color: white !important;
      transition: background-color .2s ease;
      border: none;
      border-radius: .5rem;
      padding: .6rem 1.2rem;
      cursor: pointer
    }

    .btn-primary:hover {
      background-color: #2563eb !important
    }

    .btn-secondary {
      background-color: #f3f4f6 !important;
      color: #374151 !important;
      border: 1px solid #d1d5db !important;
      border-radius: .5rem;
      padding: .6rem 1.2rem;
      cursor: pointer
    }

    .btn-secondary:hover {
      background-color: #e5e7eb !important
    }

    .delete-category-options {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin: 1rem 0
    }

    .option-item {
      display: flex;
      align-items: center;
      gap: .5rem;
      padding: .75rem;
      border: 1px solid #e5e7eb;
      border-radius: .5rem;
      cursor: pointer;
      transition: background-color .2s ease
    }

    .option-item:hover {
      background-color: #f9fafb
    }

    .option-item.selected {
      border-color: #3b82f6;
      background-color: #eff6ff
    }

    .option-radio {
      width: 18px;
      height: 18px;
      accent-color: #3b82f6
    }

    .modal {
      position: fixed;
      inset: 0;
      background-color: rgba(0, 0, 0, 0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 100;
      visibility: hidden;
      opacity: 0;
      transition: visibility 0s linear 0.25s, opacity 0.25s;
    }

    .modal.show {
      visibility: visible;
      opacity: 1;
      transition-delay: 0s;
    }

    .modal-content {
      background-color: white;
      border-radius: 1rem;
      padding: 2rem;
      width: 90%;
      max-width: 500px;
      box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
      transform: scale(0.95);
      transition: transform 0.25s;
    }

    .modal.show .modal-content {
      transform: scale(1);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 1.5rem;
    }

    .modal-title {
      font-size: 1.25rem;
      font-weight: 600;
      color: #111827;
      margin: 0;
    }

    .modal-close {
      background: none;
      border: none;
      font-size: 1.5rem;
      cursor: pointer;
      color: #6b7280;
      transition: color .2s ease;
    }

    .modal-close:hover {
      color: #ef4444;
    }

    .form-group {
      margin-bottom: 1.5rem;
    }

    .form-label {
      display: block;
      margin-bottom: .5rem;
      font-weight: 500;
      color: #374151;
    }

    .form-input {
      width: 100%;
      padding: .75rem 1rem;
      border: 1px solid #d1d5db;
      border-radius: .5rem;
      font-size: 1rem;
      transition: border-color .2s ease;
    }

    .form-input:focus {
      outline: none;
      border-color: #3b82f6;
      box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
    }

    .modal-footer {
      display: flex;
      gap: 1rem;
      justify-content: flex-end;
      margin-top: 2rem;
    }

    .config-hint {
      font-size: .875rem;
      color: #6b7280;
      margin-top: .25rem;
      line-height: 1.4;
    }

    .config-hint a {
      color: #3b82f6;
      text-decoration: underline;
    }

    .empty-state {
      grid-column: 1/-1;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      padding: 4rem 2rem;
      text-align: center;
      color: #6b7280;
    }

    .empty-state-icon {
      font-size: 4rem;
      margin-bottom: 1.5rem;
      color: #d1d5db;
    }

    .empty-state-title {
      font-size: 1.25rem;
      font-weight: 600;
      margin-bottom: .5rem;
      color: #111827;
    }

    .empty-state-desc {
      max-width: 400px;
      margin-bottom: 2rem;
    }

    .notification {
      position: fixed;
      bottom: 2rem;
      right: 2rem;
      padding: 1rem 1.5rem;
      border-radius: .5rem;
      background-color: white;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
      display: flex;
      align-items: center;
      gap: 1rem;
      z-index: 100;
      transform: translateY(20px);
      opacity: 0;
      transition: transform .3s ease, opacity .3s ease;
    }

    .notification.show {
      transform: translateY(0);
      opacity: 1;
    }

    .notification-icon {
      font-size: 1.25rem;
    }

    .notification-success .notification-icon {
      color: #10b981;
    }

    .notification-error .notification-icon {
      color: #ef4444;
    }

    .notification-warning .notification-icon {
      color: #f59e0b;
    }

    .notification-message {
      color: #111827;
      font-size: .95rem;
    }

    footer {
      background-color: white;
      border-top: 1px solid #e5e7eb;
      padding: 1.5rem;
      text-align: center;
      color: #6b7280;
      font-size: .9rem;
      margin-top: 2rem;
    }

    @media (max-width: 768px) {
      .nav-btn span:not(.icon) {
        display: none;
      }

      .nav-btn .icon {
        display: block;
        font-size: 1.2rem;
      }

      .category-tab {
        padding: .5rem 1rem;
        font-size: .85rem;
      }

      .add-category-btn {
        padding: .5rem 1rem;
        font-size: .85rem;
      }

      .add-category-btn span:not(.icon) {
        display: none;
      }
    }

    .bookmark-menu {
      position: absolute;
      top: 1rem;
      right: 1rem;
      z-index: 20;
    }

    .menu-trigger {
      width: 30px;
      height: 30px;
      border-radius: 50%;
      background-color: #f3f4f6;
      color: #374151;
      border: none;
      cursor: pointer;
      font-size: 1rem;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: all .2s ease;
      box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
    }

    .menu-trigger:hover {
      background-color: #e5e7eb;
      color: #111827;
    }

    .menu-dropdown {
      position: absolute;
      top: 100%;
      right: 0;
      margin-top: .3rem;
      background-color: white;
      border-radius: .4rem;
      box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
      padding: .3rem 0;
      width: 90px;
      display: none;
      flex-direction: column;
      gap: .1rem;
    }

    .menu-item {
      display: flex;
      align-items: center;
      gap: .4rem;
      padding: .4rem .8rem;
      background: none;
      border: none;
      cursor: pointer;
      font-size: .8rem;
      transition: background-color .2s ease;
    }

    .menu-item.move {
      color: #3b82f6;
    }

    .menu-item.delete {
      color: #ef4444;
    }

    .menu-item:hover {
      background-color: #f9fafb;
    }

    .pending-destroy-tag {
      position: absolute;
      top: 1rem;
      left: 1rem;
      background-color: #ef4444;
      color: white;
      font-size: .7rem;
      padding: .2rem .5rem;
      border-radius: .3rem;
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.2);
      z-index: 10;
    }

    .bookmark-title {
      font-size: 1.15rem;
      margin: 0 0 .75rem 0;
      color: #111827;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
      font-weight: 600;
      max-width: 220px;
    }

    .bookmark-url {
      font-size: .85rem;
      color: #6b7280;
      margin: 0 0 1rem 0;
      word-break: break-all;
      overflow-y: auto;
      max-height: 60px;
      flex: 1;
      line-height: 1.4;
    }

    .bookmark-url::-webkit-scrollbar {
      display: none;
    }

    .bookmark-url {
      scrollbar-width: none;
    }

    .bookmark-visit-btn {
      display: block;
      width: 100%;
      padding: .7rem;
      text-align: center;
      background-color: #f9fafb;
      color: #111827;
      border-radius: .5rem;
      text-decoration: none;
      transition: background-color .2s ease;
      margin-top: auto;
      font-size: .95rem;
      font-weight: 500;
    }

    .bookmark-visit-btn:hover {
      background-color: #f3f4f6;
    }
  </style>
</head>

<body>
  <header>
    <div class="header-container">
      <div class="logo">
        <span class="logo-icon">ğŸ”–</span>
        <h1 class="logo-text">Bookmark Pro</h1>
      </div>
      <div class="nav-buttons">
        <button class="nav-btn import-edge-btn" id="import-edge-btn"><span
            class="icon">ğŸ“¤</span><span>å¯¼å…¥Edge</span></button>
        <button class="nav-btn export-edge-btn" id="export-edge-btn"><span
            class="icon">ğŸ“¥</span><span>å¯¼å‡ºEdge</span></button>
        <button class="nav-btn sync-github-btn" id="sync-github-btn"><span
            class="icon">ğŸ”„</span><span>åŒæ­¥GitHub</span></button>
        <button class="nav-btn add-btn" id="add-btn"><span class="icon">+</span><span>æ·»åŠ ä¹¦ç­¾</span></button>
      </div>
    </div>
  </header>

  <div class="category-tabs-container" id="category-tabs-container">
    <button class="category-tab active" data-category="all">å…¨éƒ¨</button>
    <button class="category-tab" data-category="work">å·¥ä½œ</button>
    <button class="category-tab" data-category="study">å­¦ä¹ </button>
    <button class="category-tab" data-category="entertainment">å¨±ä¹</button>
    <button class="category-tab" data-category="other">å…¶ä»–</button>
    <button class="add-category-btn" id="add-category-btn"><span class="icon">+</span><span>æ–°å¢åˆ†ç±»</span></button>
  </div>

  <main class="main-content">
    <!-- æ–°å¢åˆ†ç±»æ¨¡æ€æ¡† -->
    <div id="add-category-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">æ–°å¢åˆ†ç±»</h3><button id="close-category-modal" class="modal-close">Ã—</button>
        </div>
        <div class="form-group">
          <label for="category-name" class="form-label">åˆ†ç±»åç§° <span class="text-red-500">*</span></label>
          <input type="text" id="category-name" class="form-input" placeholder="è¾“å…¥åˆ†ç±»åç§°">
          <div id="category-error" class="error-message">è¯·è¾“å…¥åˆ†ç±»åç§°</div>
        </div>
        <div class="modal-footer"><button type="button" id="cancel-category-modal"
            class="btn-secondary">å–æ¶ˆ</button><button type="button" id="save-category-btn"
            class="btn-primary">ä¿å­˜</button></div>
      </div>
    </div>

    <!-- åˆ é™¤åˆ†ç±»æ¨¡æ€æ¡† -->
    <div id="delete-category-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title" id="delete-modal-title">æ“ä½œåˆ†ç±»</h3><button id="close-delete-modal"
            class="modal-close">Ã—</button>
        </div>
        <p class="text-gray-600 mb-4" id="delete-modal-desc">ç¡®å®šè¦åˆ é™¤è¯¥åˆ†ç±»å—ï¼Ÿè¯·é€‰æ‹©è¯¥åˆ†ç±»ä¸‹ä¹¦ç­¾çš„å¤„ç†æ–¹å¼ï¼š</p>
        <div class="delete-category-options">
          <div class="option-item selected">
            <input type="radio" name="delete-option" value="move" class="option-radio" checked>
            <div>
              <div class="font-medium">ç§»åŠ¨åˆ°å…¶ä»–åˆ†ç±»</div>
              <div class="text-sm text-gray-500">å°†è¯¥åˆ†ç±»ä¸‹çš„æ‰€æœ‰ä¹¦ç­¾ç§»åŠ¨åˆ°æŒ‡å®šåˆ†ç±»ï¼ˆä¿ç•™å¾…é”€æ¯æ ‡è¯†ï¼‰</div>
            </div>
          </div>
          <div class="option-item">
            <input type="radio" name="delete-option" value="mark-destroy" class="option-radio">
            <div>
              <div class="font-medium">æ ‡è®°ä¸ºå¾…é”€æ¯</div>
              <div class="text-sm text-gray-500">å°†è¯¥åˆ†ç±»ä¸‹çš„æ‰€æœ‰ä¹¦ç­¾æ ‡è®°ä¸ºå¾…é”€æ¯ï¼ŒåŒæ­¥æ—¶ç»Ÿä¸€åˆ é™¤ï¼ˆå«GitHubï¼‰</div>
            </div>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">ç›®æ ‡åˆ†ç±»</label>
          <select id="move-target-category" class="form-input"></select>
        </div>
        <div class="modal-footer"><button type="button" id="cancel-delete-modal"
            class="btn-secondary">å–æ¶ˆ</button><button type="button" id="confirm-delete-btn"
            class="btn-primary bg-red-500 hover:bg-red-600">ç¡®è®¤æ“ä½œ</button></div>
      </div>
    </div>

    <!-- ç§»åŠ¨ä¹¦ç­¾æ¨¡æ€æ¡† -->
    <div id="move-bookmark-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">ç§»åŠ¨åˆ°åˆ†ç±»</h3><button id="close-move-modal" class="modal-close">Ã—</button>
        </div>
        <div class="form-group">
          <label class="form-label">é€‰æ‹©ç›®æ ‡åˆ†ç±»</label>
          <select id="target-category" class="form-input"></select>
        </div>
        <input type="hidden" id="current-bookmark-id">
        <div class="modal-footer"><button type="button" id="cancel-move-modal" class="btn-secondary">å–æ¶ˆ</button><button
            type="button" id="confirm-move-modal" class="btn-primary">ç¡®è®¤ç§»åŠ¨</button></div>
      </div>
    </div>

    <!-- GitHubé…ç½®æ¨¡æ€æ¡† -->
    <div id="github-config-modal" class="modal">
      <div class="modal-content">
        <div class="modal-header">
          <h3 class="modal-title">GitHubåŒæ­¥é…ç½®</h3><button id="close-config-modal" class="modal-close">Ã—</button>
        </div>
        <div class="form-group">
          <label for="github-token" class="form-label">GitHubä¸ªäººä»¤ç‰Œ <span class="text-red-500">*</span></label>
          <input type="text" id="github-token" class="form-input" placeholder="è¾“å…¥GitHub Personal Access Token">
          <div class="config-hint">ä»¤ç‰Œéœ€å…·å¤‡ <code>repo</code> æƒé™ï¼ˆå…¬å¼€ä»“åº“ä»…éœ€ <code>public_repo</code>ï¼‰ï¼Œ<a
              href="https://github.com/settings/tokens/new" target="_blank" rel="noopener">ç‚¹å‡»åˆ›å»ºä»¤ç‰Œ</a></div>
          <div id="token-error" class="error-message">è¯·è¾“å…¥æœ‰æ•ˆçš„GitHubä»¤ç‰Œ</div>
        </div>
        <div class="form-group">
          <label for="github-owner" class="form-label">ä»“åº“æ‰€æœ‰è€… <span class="text-red-500">*</span></label>
          <input type="text" id="github-owner" class="form-input" placeholder="GitHubç”¨æˆ·å/ç»„ç»‡å" value="xgd1062">
          <div class="config-hint">ä¾‹å¦‚ï¼šä»“åº“åœ°å€ <code>https://github.com/xxx/yyy</code> ä¸­ï¼Œæ‰€æœ‰è€…ä¸º <code>xxx</code></div>
          <div id="owner-error" class="error-message">è¯·è¾“å…¥ä»“åº“æ‰€æœ‰è€…</div>
        </div>
        <div class="form-group">
          <label for="github-repo" class="form-label">ä»“åº“åç§° <span class="text-red-500">*</span></label>
          <input type="text" id="github-repo" class="form-input" placeholder="è¾“å…¥ä»“åº“åç§°" value="1062">
          <div class="config-hint">ä¾‹å¦‚ï¼šä»“åº“åœ°å€ <code>https://github.com/xxx/yyy</code> ä¸­ï¼Œä»“åº“åä¸º <code>yyy</code></div>
          <div id="repo-error" class="error-message">è¯·è¾“å…¥ä»“åº“åç§°</div>
        </div>
        <div class="form-group">
          <label for="github-path" class="form-label">æ–‡ä»¶è·¯å¾„ <span class="text-red-500">*</span></label>
          <input type="text" id="github-path" class="form-input" placeholder="ä¾‹å¦‚ï¼šbookmarks/bookmarks.html"
            value="000/10 ä¹¦ç­¾é¡µ-bookmarks.html">
          <div class="config-hint">ä¹¦ç­¾æ–‡ä»¶åœ¨ä»“åº“ä¸­çš„è·¯å¾„ï¼Œé»˜è®¤ <code>000/10 ä¹¦ç­¾é¡µ-bookmarks.html</code>ï¼ˆEdge HTMLæ ¼å¼ï¼‰</div>
          <div id="path-error" class="error-message">è¯·è¾“å…¥æ–‡ä»¶è·¯å¾„</div>
        </div>
        <div class="modal-footer"><button type="button" id="cancel-config-modal"
            class="btn-secondary">å–æ¶ˆ</button><button type="button" id="save-config-btn"
            class="btn-primary">ä¿å­˜é…ç½®</button></div>
      </div>
    </div>

    <div id="bookmarks-grid">
      <div id="empty-state" class="empty-state">
        <div class="empty-state-icon">ğŸ”–</div>
        <h3 class="empty-state-title">æš‚æ— ä¹¦ç­¾</h3>
        <p class="empty-state-desc">æ·»åŠ ä½ çš„ç¬¬ä¸€ä¸ªä¹¦ç­¾ï¼Œå¼€å§‹æ•´ç†ä½ çš„ç½‘ç»œèµ„æº</p>
        <button id="empty-add-btn" class="btn-primary">æ·»åŠ ä¹¦ç­¾</button>
      </div>
      <div id="loading-state" class="empty-state hidden">
        <div class="loader w-12 h-12 border-4 border-gray-200 rounded-full mb-4"></div>
        <p class="text-gray-500">åŠ è½½ä¸­...</p>
      </div>
    </div>
  </main>

  <footer>
    <p>Â© 2025 Bookmark Pro - æ”¯æŒEdge+GitHubåŒå‘åŒæ­¥</p>
  </footer>

  <!-- æ·»åŠ ä¹¦ç­¾æ¨¡æ€æ¡† -->
  <div id="bookmark-modal" class="modal">
    <div class="modal-content">
      <div class="modal-header">
        <h3 class="modal-title">æ·»åŠ ä¹¦ç­¾</h3><button id="close-modal" class="modal-close">Ã—</button>
      </div>
      <div class="form-group">
        <label for="bookmark-name" class="form-label">åç§° <span class="text-red-500">*</span></label>
        <input type="text" id="bookmark-name" class="form-input" placeholder="è¾“å…¥ä¹¦ç­¾åç§°ï¼ˆæœ€å¤š10å­—ç¬¦ï¼‰">
        <div id="name-error" class="error-message">è¯·è¾“å…¥åç§°</div>
      </div>
      <div class="form-group">
        <label for="bookmark-url" class="form-label">URL <span class="text-red-500">*</span></label>
        <input type="text" id="bookmark-url" class="form-input" placeholder="ä¾‹å¦‚ï¼šhttps://www.baidu.com">
        <div id="url-error" class="error-message">è¯·è¾“å…¥æœ‰æ•ˆçš„URL</div>
      </div>
      <div class="form-group">
        <label for="bookmark-category" class="form-label">åˆ†ç±»</label>
        <select id="bookmark-category" class="form-input"></select>
      </div>
      <div class="modal-footer"><button type="button" id="cancel-modal" class="btn-secondary">å–æ¶ˆ</button><button
          type="button" id="save-bookmark" class="btn-primary">ä¿å­˜</button></div>
    </div>
  </div>

  <div id="notification" class="notification">
    <span id="notification-icon" class="notification-icon">âœ“</span>
    <span id="notification-message" class="notification-message">æ“ä½œæˆåŠŸ</span>
  </div>

  <input type="file" id="import-edge-file" accept=".html" class="hidden" />

  <script>
    let bookmarks = [],
      categories = ['work', 'study', 'entertainment', 'other'],
      categoryNames = { work: 'å·¥ä½œ', study: 'å­¦ä¹ ', entertainment: 'å¨±ä¹', other: 'å…¶ä»–' },
      currentCategory = 'all',
      categoryToDelete = '',
      pendingDeleteCategories = JSON.parse(localStorage.getItem('pendingDeleteCategories')) || [];

    const GITHUB_CONFIG_KEY = 'githubBookmarkConfig';
    const SYNC_FAIL_COUNT_KEY = 'githubSyncFailCount';
    let githubConfig = JSON.parse(localStorage.getItem(GITHUB_CONFIG_KEY)) || null;
    let syncFailCount = parseInt(localStorage.getItem(SYNC_FAIL_COUNT_KEY)) || 0;

    const el = {
      addBtn: document.getElementById('add-btn'),
      emptyAddBtn: document.getElementById('empty-add-btn'),
      bookmarkModal: document.getElementById('bookmark-modal'),
      closeModal: document.getElementById('close-modal'),
      cancelModal: document.getElementById('cancel-modal'),
      saveBookmark: document.getElementById('save-bookmark'),
      bookmarksGrid: document.getElementById('bookmarks-grid'),
      emptyState: document.getElementById('empty-state'),
      loadingState: document.getElementById('loading-state'),
      categoryContainer: document.getElementById('category-tabs-container'),
      importEdgeBtn: document.getElementById('import-edge-btn'),
      exportEdgeBtn: document.getElementById('export-edge-btn'),
      importEdgeFile: document.getElementById('import-edge-file'),
      syncGithubBtn: document.getElementById('sync-github-btn'),
      githubConfigModal: document.getElementById('github-config-modal'),
      closeConfigModal: document.getElementById('close-config-modal'),
      cancelConfigModal: document.getElementById('cancel-config-modal'),
      saveConfigBtn: document.getElementById('save-config-btn'),
      githubToken: document.getElementById('github-token'),
      githubOwner: document.getElementById('github-owner'),
      githubRepo: document.getElementById('github-repo'),
      githubPath: document.getElementById('github-path'),
      tokenError: document.getElementById('token-error'),
      ownerError: document.getElementById('owner-error'),
      repoError: document.getElementById('repo-error'),
      pathError: document.getElementById('path-error'),
      addCategoryBtn: document.getElementById('add-category-btn'),
      addCategoryModal: document.getElementById('add-category-modal'),
      closeCategoryModal: document.getElementById('close-category-modal'),
      cancelCategoryModal: document.getElementById('cancel-category-modal'),
      saveCategoryBtn: document.getElementById('save-category-btn'),
      categoryName: document.getElementById('category-name'),
      categoryError: document.getElementById('category-error'),
      bookmarkCategory: document.getElementById('bookmark-category'),
      deleteCategoryModal: document.getElementById('delete-category-modal'),
      closeDeleteModal: document.getElementById('close-delete-modal'),
      cancelDeleteModal: document.getElementById('cancel-delete-modal'),
      confirmDeleteBtn: document.getElementById('confirm-delete-btn'),
      deleteModalTitle: document.getElementById('delete-modal-title'),
      moveTargetCategory: document.getElementById('move-target-category'),
      optionItems: document.querySelectorAll('.option-item'),
      bookmarkName: document.getElementById('bookmark-name'),
      bookmarkUrl: document.getElementById('bookmark-url'),
      nameError: document.getElementById('name-error'),
      urlError: document.getElementById('url-error'),
      notification: document.getElementById('notification'),
      notificationMessage: document.getElementById('notification-message'),
      notificationIcon: document.getElementById('notification-icon'),
      moveBookmarkModal: document.getElementById('move-bookmark-modal'),
      closeMoveModal: document.getElementById('close-move-modal'),
      cancelMoveModal: document.getElementById('cancel-move-modal'),
      confirmMoveModal: document.getElementById('confirm-move-modal'),
      targetCategory: document.getElementById('target-category'),
      currentBookmarkId: document.getElementById('current-bookmark-id')
    };

    document.addEventListener('DOMContentLoaded', () => {
      try {
        const savedBookmarks = localStorage.getItem('bookmarks');
        bookmarks = savedBookmarks ? JSON.parse(savedBookmarks) : [];
        bookmarks = bookmarks.map(bookmark => ({ ...bookmark, destroyed: bookmark.destroyed ?? false }));
        if (!Array.isArray(bookmarks)) bookmarks = [];

        const savedCategories = localStorage.getItem('categories');
        const savedCustomCategories = localStorage.getItem('customCategories');
        const savedCategoryNames = localStorage.getItem('categoryNames');

        if (savedCategories) {
          categories = JSON.parse(savedCategories);
        } else if (savedCustomCategories) {
          categories = ['work', 'study', 'entertainment', 'other', ...JSON.parse(savedCustomCategories)];
        }

        if (savedCategoryNames) categoryNames = { ...categoryNames, ...JSON.parse(savedCategoryNames) };
      } catch (e) {
        console.error('åŠ è½½æ•°æ®å¤±è´¥:', e);
        bookmarks = [];
        localStorage.removeItem('bookmarks');
      }

      if (syncFailCount >= 3) {
        clearGithubConfig();
        showNotify('åŒæ­¥å¤±è´¥æ¬¡æ•°è¿‡å¤šï¼Œå·²æ¸…é™¤é…ç½®ï¼Œè¯·é‡æ–°è®¾ç½®', 'warning');
      }

      bindEvents();
      bindMoveModalEvents();
      renderCats();
      renderBookmarks();

      if (!githubConfig && syncFailCount < 3) {
        setTimeout(() => { openGithubConfigModal(); }, 1000);
      }
    });

    function bindEvents() {
      // æ·»åŠ ä¹¦ç­¾ç›¸å…³äº‹ä»¶
      el.addBtn.addEventListener('click', openModal);
      el.emptyAddBtn.addEventListener('click', openModal);
      el.closeModal.addEventListener('click', closeModal);
      el.cancelModal.addEventListener('click', closeModal);
      el.saveBookmark.addEventListener('click', saveBookmark);
      el.bookmarkModal.addEventListener('click', handleModalOutsideClick);

      // åˆ†ç±»æ ‡ç­¾ç‚¹å‡»äº‹ä»¶
      el.categoryContainer.addEventListener('click', e => {
        const tab = e.target.closest('.category-tab');
        if (tab && !e.target.closest('.category-delete-btn')) {
          const cat = tab.dataset.category;
          if (cat) {
            document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
            tab.classList.add('active');
            currentCategory = cat;
            renderBookmarks();
            window.scrollTo({ top: document.querySelector('.main-content').offsetTop - 100, behavior: 'smooth' });
          }
        }
      });

      // åˆ†ç±»åˆ é™¤æŒ‰é’®äº‹ä»¶
      el.categoryContainer.addEventListener('click', function (e) {
        const delBtn = e.target.closest('.category-delete-btn');
        if (delBtn) {
          e.stopPropagation();
          const tab = delBtn.closest('.category-tab');
          if (tab && tab.dataset.category) {
            openDeleteModal(tab.dataset.category);
          }
        }
      }, true);

      // Edgeå¯¼å…¥å¯¼å‡ºäº‹ä»¶
      el.importEdgeBtn.addEventListener('click', () => el.importEdgeFile.click());
      el.importEdgeFile.addEventListener('change', handleImportEdge);
      el.exportEdgeBtn.addEventListener('click', handleExportEdge);
      el.syncGithubBtn.addEventListener('click', syncWithGitHub);

      // GitHubé…ç½®æ¨¡æ€æ¡†äº‹ä»¶
      el.closeConfigModal.addEventListener('click', closeGithubConfigModal);
      el.cancelConfigModal.addEventListener('click', closeGithubConfigModal);
      el.saveConfigBtn.addEventListener('click', saveGithubConfig);
      el.githubConfigModal.addEventListener('click', handleModalOutsideClick);

      // æ–°å¢åˆ†ç±»æ¨¡æ€æ¡†äº‹ä»¶
      el.addCategoryBtn.addEventListener('click', openAddCategoryModal);
      el.closeCategoryModal.addEventListener('click', closeAddCategoryModal);
      el.cancelCategoryModal.addEventListener('click', closeAddCategoryModal);
      el.saveCategoryBtn.addEventListener('click', saveNewCategory);
      el.addCategoryModal.addEventListener('click', handleModalOutsideClick);

      // åˆ é™¤åˆ†ç±»æ¨¡æ€æ¡†äº‹ä»¶
      el.closeDeleteModal.addEventListener('click', closeDeleteModal);
      el.cancelDeleteModal.addEventListener('click', closeDeleteModal);
      el.confirmDeleteBtn.addEventListener('click', confirmDelete);
      el.deleteCategoryModal.addEventListener('click', handleModalOutsideClick);

      // é€‰é¡¹ç‚¹å‡»äº‹ä»¶
      el.optionItems.forEach(item => item.addEventListener('click', () => {
        el.optionItems.forEach(i => i.classList.remove('selected'));
        item.classList.add('selected');
        const radio = item.querySelector('.option-radio');
        radio.checked = true;
      }));
    }

    function handleModalOutsideClick(e) {
      if (e.target === this) {
        const modalId = this.id;
        switch (modalId) {
          case 'bookmark-modal': closeModal(); break;
          case 'add-category-modal': closeAddCategoryModal(); break;
          case 'delete-category-modal': closeDeleteModal(); break;
          case 'github-config-modal': closeGithubConfigModal(); break;
          case 'move-bookmark-modal': closeMoveModal(); break;
        }
      }
    }

    function bindMoveModalEvents() {
      el.closeMoveModal.addEventListener('click', closeMoveModal);
      el.cancelMoveModal.addEventListener('click', closeMoveModal);
      el.confirmMoveModal.addEventListener('click', () => {
        const bookmarkId = el.currentBookmarkId.value;
        const targetCat = el.targetCategory.value;

        if (!bookmarkId || !targetCat) return;

        const bookmarkIndex = bookmarks.findIndex(b => b.id === bookmarkId);
        if (bookmarkIndex !== -1) {
          bookmarks[bookmarkIndex].category = targetCat;
          localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
          renderBookmarks();
          closeMoveModal();
          showNotify(`ä¹¦ç­¾å·²ç§»åŠ¨åˆ°ã€Œ${categoryNames[targetCat] || targetCat}ã€`);
        }
      });
      el.moveBookmarkModal.addEventListener('click', handleModalOutsideClick);
    }

    function openModal() {
      el.bookmarkName.value = '';
      el.bookmarkUrl.value = '';
      el.nameError.style.display = 'none';
      el.urlError.style.display = 'none';
      el.bookmarkName.classList.remove('input-error');
      el.bookmarkUrl.classList.remove('input-error');
      el.bookmarkModal.classList.add('show');
      document.body.style.overflow = 'hidden';
      el.bookmarkName.focus();
    }

    function closeModal() {
      el.bookmarkModal.classList.remove('show');
      document.body.style.overflow = 'auto';
    }

    function openAddCategoryModal() {
      el.categoryName.value = '';
      el.categoryError.style.display = 'none';
      el.addCategoryModal.classList.add('show');
      document.body.style.overflow = 'hidden';
      el.categoryName.focus();
    }

    function closeAddCategoryModal() {
      el.addCategoryModal.classList.remove('show');
      document.body.style.overflow = 'auto';
    }

    function openDeleteModal(catId) {
      if (!catId) {
        console.error('ç¼ºå°‘åˆ†ç±»IDï¼Œæ— æ³•æ‰“å¼€åˆ é™¤æ¨¡æ€æ¡†');
        return;
      }

      categoryToDelete = catId;
      const catName = categoryNames[catId] || catId;
      el.deleteModalTitle.textContent = `æ“ä½œåˆ†ç±»ï¼š${catName}`;

      // æ›´æ–°ç›®æ ‡åˆ†ç±»ä¸‹æ‹‰æ¡†
      const targetOptions = categories
        .filter(cat => !pendingDeleteCategories.includes(cat) && cat !== catId)
        .map(cat => `<option value="${cat}">${categoryNames[cat] || cat}</option>`).join('');
      el.moveTargetCategory.innerHTML = targetOptions;

      el.deleteCategoryModal.classList.add('show');
      document.body.style.overflow = 'hidden';
    }

    function closeDeleteModal() {
      el.deleteCategoryModal.classList.remove('show');
      document.body.style.overflow = 'auto';
      categoryToDelete = '';
    }

    function openGithubConfigModal() {
      if (githubConfig) {
        el.githubToken.value = githubConfig.token || '';
        el.githubOwner.value = githubConfig.owner || 'xgd1062';
        el.githubRepo.value = githubConfig.repo || '1062';
        el.githubPath.value = githubConfig.path || '000/10 ä¹¦ç­¾é¡µ-bookmarks.html';
      } else {
        // è®¾ç½®é»˜è®¤å€¼
        el.githubOwner.value = 'xgd1062';
        el.githubRepo.value = '1062';
        el.githubPath.value = '000/10 ä¹¦ç­¾é¡µ-bookmarks.html';
      }
      el.githubConfigModal.classList.add('show');
      document.body.style.overflow = 'hidden';
      el.githubToken.focus();
    }

    function closeGithubConfigModal() {
      el.githubConfigModal.classList.remove('show');
      document.body.style.overflow = 'auto';
      el.tokenError.style.display = 'none';
      el.ownerError.style.display = 'none';
      el.repoError.style.display = 'none';
      el.pathError.style.display = 'none';
    }

    function openMoveModal(bookmarkId) {
      el.currentBookmarkId.value = bookmarkId;
      const bookmark = bookmarks.find(b => b.id === bookmarkId);
      if (bookmark) {
        el.targetCategory.value = bookmark.category;
      }
      el.moveBookmarkModal.classList.add('show');
      document.body.style.overflow = 'hidden';
    }

    function closeMoveModal() {
      el.moveBookmarkModal.classList.remove('show');
      document.body.style.overflow = 'auto';
    }

    // ä¿å­˜ä¹¦ç­¾
    function saveBookmark() {
      const name = el.bookmarkName.value.trim();
      const url = el.bookmarkUrl.value.trim();
      const cat = el.bookmarkCategory.value;
      let valid = true;

      if (!name) {
        el.nameError.style.display = 'block';
        el.nameError.textContent = 'è¯·è¾“å…¥åç§°';
        el.bookmarkName.classList.add('input-error');
        valid = false;
      } else if (name.length > 10) {
        el.nameError.style.display = 'block';
        el.nameError.textContent = 'åç§°æœ€å¤š10ä¸ªå­—ç¬¦';
        el.bookmarkName.classList.add('input-error');
        valid = false;
      } else {
        el.nameError.style.display = 'none';
        el.bookmarkName.classList.remove('input-error');
      }

      if (!url) {
        el.urlError.style.display = 'block';
        el.urlError.textContent = 'è¯·è¾“å…¥URL';
        el.bookmarkUrl.classList.add('input-error');
        valid = false;
      } else {
        let newUrl = url;
        if (!newUrl.startsWith('http://') && !newUrl.startsWith('https://')) newUrl = 'https://' + newUrl;
        try {
          new URL(newUrl);
          el.urlError.style.display = 'none';
          el.bookmarkUrl.classList.remove('input-error');
        } catch (e) {
          el.urlError.style.display = 'block';
          el.urlError.textContent = 'URLæ ¼å¼ä¸æ­£ç¡®';
          el.bookmarkUrl.classList.add('input-error');
          valid = false;
        }
      }

      if (!valid) return;

      const newUrl = url.startsWith('http') ? url : 'https://' + url;
      if (existingBookmark(newUrl)) {
        showNotify('è¯¥URLå·²å­˜åœ¨ä¹¦ç­¾', 'warning');
        return;
      }

      const bookmark = {
        id: Date.now().toString(),
        name: name,
        url: newUrl,
        category: cat,
        createdAt: new Date().toLocaleString(),
        destroyed: false
      };
      bookmarks.push(bookmark);

      try {
        localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
        renderBookmarks();
        closeModal();
        showNotify('ä¹¦ç­¾æ·»åŠ æˆåŠŸ');
      } catch (e) {
        showNotify('ä¿å­˜å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
      }
    }

    // æ¸²æŸ“åˆ†ç±»
    function renderCats() {
      const addCategoryBtn = document.createElement('button');
      addCategoryBtn.className = 'add-category-btn';
      addCategoryBtn.id = 'add-category-btn';
      addCategoryBtn.innerHTML = '<span class="icon">+</span><span>æ–°å¢åˆ†ç±»</span>';
      addCategoryBtn.addEventListener('click', openAddCategoryModal);

      el.categoryContainer.innerHTML = '';

      // æ·»åŠ "å…¨éƒ¨"åˆ†ç±»
      const allTab = document.createElement('button');
      allTab.className = `category-tab ${currentCategory === 'all' ? 'active' : ''}`;
      allTab.dataset.category = 'all';
      allTab.textContent = 'å…¨éƒ¨';
      el.categoryContainer.appendChild(allTab);

      // æ·»åŠ å…¶ä»–åˆ†ç±»
      categories.forEach(cat => {
        if (pendingDeleteCategories.includes(cat)) return;

        const tab = document.createElement('button');
        tab.className = `category-tab ${currentCategory === cat ? 'active' : ''}`;
        tab.dataset.category = cat;
        tab.textContent = categoryNames[cat] || cat;

        // åªæœ‰è‡ªå®šä¹‰åˆ†ç±»æ‰æ˜¾ç¤ºåˆ é™¤æŒ‰é’®
        if (!['work', 'study', 'entertainment', 'other'].includes(cat)) {
          const delBtn = document.createElement('button');
          delBtn.className = 'category-delete-btn';
          delBtn.textContent = 'Ã—';
          delBtn.addEventListener('click', (e) => {
            e.stopPropagation();
            openDeleteModal(cat);
          });
          tab.appendChild(delBtn);
        }

        el.categoryContainer.appendChild(tab);
      });

      el.categoryContainer.appendChild(addCategoryBtn);

      // æ›´æ–°åˆ†ç±»é€‰æ‹©å™¨
      const categoryOptions = categories
        .filter(cat => !pendingDeleteCategories.includes(cat))
        .map(cat => `<option value="${cat}">${categoryNames[cat] || cat}</option>`).join('');

      el.bookmarkCategory.innerHTML = categoryOptions;
      el.moveTargetCategory.innerHTML = categoryOptions;
      el.targetCategory.innerHTML = categoryOptions;
    }

    // æ¸²æŸ“ä¹¦ç­¾
    function renderBookmarks() {
      showLoading();
      setTimeout(() => {
        const filtered = currentCategory === 'all'
          ? [...bookmarks]
          : bookmarks.filter(item => item.category === currentCategory);
        el.bookmarksGrid.innerHTML = '';

        if (filtered.length === 0) {
          const emptyState = document.createElement('div');
          emptyState.className = 'empty-state';
          emptyState.innerHTML = `
            <div class="empty-state-icon">ğŸ”–</div>
            <h3 class="empty-state-title">${currentCategory === 'all' ? 'æš‚æ— ä¹¦ç­¾' : 'æš‚æ— ' + (categoryNames[currentCategory] || currentCategory) + 'åˆ†ç±»çš„ä¹¦ç­¾'}</h3>
            <p class="empty-state-desc">æ·»åŠ ä½ çš„ç¬¬ä¸€ä¸ªä¹¦ç­¾ï¼Œå¼€å§‹æ•´ç†ä½ çš„ç½‘ç»œèµ„æº</p>
            <button class="btn-primary" onclick="document.getElementById('add-btn').click()">æ·»åŠ ä¹¦ç­¾</button>
          `;
          el.bookmarksGrid.appendChild(emptyState);
        } else {
          filtered.forEach(item => el.bookmarksGrid.appendChild(createCard(item)));
        }
        hideLoading();
      }, 300);
    }

    // åˆ›å»ºä¹¦ç­¾å¡ç‰‡
    function createCard(bookmark) {
      const card = document.createElement('div');
      card.className = 'bookmark-card';

      const shortName = bookmark.name.length > 10 ? bookmark.name.slice(0, 10) + 'â€¦' : bookmark.name;
      const destroyTag = bookmark.destroyed ? '<span class="pending-destroy-tag">å¾…é”€æ¯</span>' : '';

      card.innerHTML = `
        ${destroyTag}
        <div class="bookmark-menu" id="menu-${bookmark.id}">
          <button class="menu-trigger" title="æ“ä½œèœå•">â‹®</button>
          <div class="menu-dropdown">
            <button class="menu-item move" data-id="${bookmark.id}">ğŸ“¤ ç§»åŠ¨</button>
            <button class="menu-item delete" data-id="${bookmark.id}" title="${bookmark.destroyed ? 'å–æ¶ˆå¾…é”€æ¯' : 'æ ‡è®°ä¸ºå¾…é”€æ¯'}">
              ${bookmark.destroyed ? 'âœ“ å–æ¶ˆ' : 'ğŸ—‘ï¸ é”€æ¯'}
            </button>
          </div>
        </div>
        <h3 class="bookmark-title" title="${bookmark.name}">${shortName}</h3>
        <p class="bookmark-url">${bookmark.url}</p>
        <a href="${bookmark.url}" target="_blank" rel="noopener noreferrer" class="bookmark-visit-btn">è®¿é—®é“¾æ¥</a>
      `;

      const menu = card.querySelector('.bookmark-menu');
      const dropdown = card.querySelector('.menu-dropdown');
      let hideTimer;

      menu.addEventListener('mouseenter', () => {
        clearTimeout(hideTimer);
        dropdown.style.display = 'flex';
      });

      menu.addEventListener('mouseleave', () => {
        hideTimer = setTimeout(() => {
          dropdown.style.display = 'none';
        }, 1000);
      });

      card.querySelector('.menu-item.move').addEventListener('click', () => {
        openMoveModal(bookmark.id);
        dropdown.style.display = 'none';
      });

      card.querySelector('.menu-item.delete').addEventListener('click', () => {
        bookmark.destroyed = !bookmark.destroyed;
        localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
        renderBookmarks();
        showNotify(bookmark.destroyed ? 'å·²æ ‡è®°ä¸ºå¾…é”€æ¯ï¼ŒåŒæ­¥æ—¶ç»Ÿä¸€åˆ é™¤' : 'å·²å–æ¶ˆå¾…é”€æ¯æ ‡è®°');
        dropdown.style.display = 'none';
      });

      return card;
    }

    // ä¿å­˜æ–°åˆ†ç±»
    function saveNewCategory() {
      const name = el.categoryName.value.trim();
      if (!name) {
        el.categoryError.style.display = 'block';
        return;
      }

      if (Object.values(categoryNames).some(c => c === name)) {
        showNotify('è¯¥åˆ†ç±»åç§°å·²å­˜åœ¨', 'warning');
        return;
      }

      const catId = name.toLowerCase().replace(/\s+/g, '-') + '-' + Date.now().toString().slice(-4);
      categories.push(catId);
      categoryNames[catId] = name;

      try {
        const customCats = categories.filter(c => !['work', 'study', 'entertainment', 'other'].includes(c));
        localStorage.setItem('customCategories', JSON.stringify(customCats));
        localStorage.setItem('categoryNames', JSON.stringify(categoryNames));
        localStorage.setItem('categories', JSON.stringify(categories));
        renderCats();
        closeAddCategoryModal();
        showNotify('åˆ†ç±»æ·»åŠ æˆåŠŸ');
      } catch (e) {
        showNotify('ä¿å­˜åˆ†ç±»å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
      }
    }

    // ç¡®è®¤åˆ é™¤åˆ†ç±»
    function confirmDelete() {
      if (!categoryToDelete) return;

      const option = document.querySelector('input[name="delete-option"]:checked').value;
      const target = el.moveTargetCategory.value;

      try {
        // å¤„ç†åˆ†ç±»ä¸‹çš„ä¹¦ç­¾
        if (option === 'move' && target) {
          bookmarks = bookmarks.map(item =>
            item.category === categoryToDelete ? { ...item, category: target } : item
          );
          showNotify(`åˆ†ç±»ä¸‹æ‰€æœ‰ä¹¦ç­¾å·²ç§»åŠ¨åˆ°ã€Œ${categoryNames[target] || target}ã€`);
        } else if (option === 'mark-destroy') {
          bookmarks = bookmarks.map(item =>
            item.category === categoryToDelete ? { ...item, destroyed: true } : item
          );
          showNotify(`åˆ†ç±»ä¸‹æ‰€æœ‰ä¹¦ç­¾å·²æ ‡è®°ä¸ºå¾…é”€æ¯`);
        }

        // æ ‡è®°åˆ†ç±»ä¸ºå¾…åˆ é™¤
        if (!pendingDeleteCategories.includes(categoryToDelete)) {
          pendingDeleteCategories.push(categoryToDelete);
          localStorage.setItem('pendingDeleteCategories', JSON.stringify(pendingDeleteCategories));
        }

        // ä¿å­˜ä¹¦ç­¾å˜åŒ–
        localStorage.setItem('bookmarks', JSON.stringify(bookmarks));

        // åˆ‡æ¢åˆ°å…¨éƒ¨åˆ†ç±»ï¼ˆå¦‚æœå½“å‰åœ¨å¾…åˆ é™¤åˆ†ç±»ï¼‰
        if (currentCategory === categoryToDelete) {
          currentCategory = 'all';
          document.querySelectorAll('.category-tab').forEach(t => t.classList.remove('active'));
          document.querySelector('.category-tab[data-category="all"]').classList.add('active');
        }

        // é‡æ–°æ¸²æŸ“
        renderCats();
        renderBookmarks();
        closeDeleteModal();
        showNotify(`åˆ†ç±»"${categoryNames[categoryToDelete] || categoryToDelete}"å·²æ ‡è®°ä¸ºå¾…åˆ é™¤`);
      } catch (e) {
        console.error('åˆ†ç±»åˆ é™¤å¤±è´¥:', e);
        showNotify('åˆ†ç±»å¤„ç†å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
      }
    }

    // å¯¼å‡ºEdgeä¹¦ç­¾
    function handleExportEdge() {
      if (bookmarks.length === 0) {
        showNotify('æ²¡æœ‰å¯å¯¼å‡ºçš„ä¹¦ç­¾', 'warning');
        return;
      }

      const exportBookmarks = bookmarks.filter(bookmark => !bookmark.destroyed);
      const html = `<!DOCTYPE NETSCAPE-Bookmark-file-1>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<META HTTP-EQUIV="Content-Language" CONTENT="zh-CN">
<TITLE>Bookmarks</TITLE>
<H1>Bookmarks</H1>
<DL><p>
  ${buildEdgeFolderStructure(exportBookmarks)}
</DL><p>`;

      const blob = new Blob([html], { type: 'text/html; charset=utf-8' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `bookmarks-edge-${new Date().toISOString().slice(0, 10)}.html`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);

      showNotify(`å·²å¯¼å‡º ${exportBookmarks.length} ä¸ªéå¾…é”€æ¯ä¹¦ç­¾`);
    }

    // æ„å»ºEdgeæ–‡ä»¶å¤¹ç»“æ„
    function buildEdgeFolderStructure(targetBookmarks = bookmarks) {
      let folderHtml = '';

      ['work', 'study', 'entertainment', 'other'].forEach(cat => {
        if (pendingDeleteCategories.includes(cat)) return;

        const catBookmarks = targetBookmarks.filter(b => b.category === cat);
        if (catBookmarks.length > 0) {
          folderHtml += `
<DT><H3 ADD_DATE="${Math.floor(Date.now() / 1000)}" LAST_MODIFIED="${Math.floor(Date.now() / 1000)}">${categoryNames[cat]}</H3>
<DL><p>
  ${catBookmarks.map(b => buildEdgeBookmarkElement(b)).join('')}
</DL><p>`;
        }
      });

      categories.filter(c => !['work', 'study', 'entertainment', 'other'].includes(c) && !pendingDeleteCategories.includes(c)).forEach(cat => {
        const catBookmarks = targetBookmarks.filter(b => b.category === cat);
        if (catBookmarks.length > 0) {
          folderHtml += `
<DT><H3 ADD_DATE="${Math.floor(Date.now() / 1000)}" LAST_MODIFIED="${Math.floor(Date.now() / 1000)}">${categoryNames[cat]}</H3>
<DL><p>
  ${catBookmarks.map(b => buildEdgeBookmarkElement(b)).join('')}
</DL><p>`;
        }
      });

      return folderHtml;
    }

    // æ„å»ºEdgeä¹¦ç­¾å…ƒç´ 
    function buildEdgeBookmarkElement(bookmark) {
      return `<DT><A HREF="${bookmark.url}" ADD_DATE="${Math.floor(Date.parse(bookmark.createdAt) / 1000)}" ICON="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAoAAAAKCAYAAACNMs+9AAAAAXNSR0IArs4c6QAAAARnQU1BAACxjwv8YQUAAAAJcEhZcwAADsMAAA7DAcdvqGQAAAAYdEVYdFNvZnR3YXJlAHBhaW50Lm5ldCA0LjAuNWWFMmUAAAAOSURBVBhXY/j//z8ABf4C7n+P/0MAAAABJRU5ErkJggg==">${bookmark.name}</A>`;
    }

    // å¯¼å…¥Edgeä¹¦ç­¾
    function handleImportEdge(e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = event => {
        try {
          const html = event.target.result;
          const parser = new DOMParser();
          const doc = parser.parseFromString(html, 'text/html');

          if (!doc.querySelector('TITLE:contains("Bookmarks")') && !doc.querySelector('H1:contains("Bookmarks")')) {
            throw new Error('ä¸æ˜¯æœ‰æ•ˆçš„Edgeä¹¦ç­¾æ–‡ä»¶');
          }

          const importedBookmarks = parseEdgeBookmarks(doc);
          let importedCount = 0;

          importedBookmarks.forEach(bookmark => {
            if (bookmark.name.length > 10) {
              bookmark.name = bookmark.name.slice(0, 10) + 'â€¦';
            }
            if (!existingBookmark(bookmark.url)) {
              bookmarks.push({ ...bookmark, destroyed: false });
              importedCount++;
            }
          });

          const customCats = categories.filter(c => !['work', 'study', 'entertainment', 'other'].includes(c));
          localStorage.setItem('customCategories', JSON.stringify(customCats));
          localStorage.setItem('categoryNames', JSON.stringify(categoryNames));
          localStorage.setItem('categories', JSON.stringify(categories));
          localStorage.setItem('bookmarks', JSON.stringify(bookmarks));

          renderCats();
          renderBookmarks();
          showNotify(`æˆåŠŸå¯¼å…¥ ${importedCount} ä¸ªEdgeä¹¦ç­¾`);
          el.importEdgeFile.value = '';
        } catch (e) {
          showNotify('Edgeå¯¼å…¥å¤±è´¥ï¼š' + e.message, 'error');
          el.importEdgeFile.value = '';
        }
      };
      reader.readAsText(file, 'UTF-8');
    }

    // è§£æEdgeä¹¦ç­¾
    function parseEdgeBookmarks(doc) {
      const imported = [];
      const nodes = doc.querySelectorAll('DL > DT > H3, DL > DT > A');
      let currentCategory = 'other';

      nodes.forEach(node => {
        if (node.tagName === 'H3') {
          const catName = node.textContent.trim() || 'æœªåˆ†ç±»';
          let catId = catName.toLowerCase().replace(/\s+/g, '-') + '-' + Date.now().toString().slice(-4);

          const existingCatId = Object.entries(categoryNames).find(([id, name]) => name === catName)?.[0];
          if (existingCatId) {
            catId = existingCatId;
          } else if (!categories.includes(catId)) {
            categories.push(catId);
            categoryNames[catId] = catName;
          }

          currentCategory = catId;
        } else if (node.tagName === 'A') {
          const url = node.href;
          const name = node.textContent.trim() || url;

          if (url && name && !url.startsWith('javascript:')) {
            const addDate = node.getAttribute('ADD_DATE') ? new Date(parseInt(node.getAttribute('ADD_DATE')) * 1000).toLocaleString() : new Date().toLocaleString();
            imported.push({
              id: Date.now().toString() + '-' + Math.floor(Math.random() * 1000),
              name: name,
              url: url,
              category: currentCategory,
              createdAt: addDate,
              destroyed: false
            });
          }
        }
      });

      return imported;
    }

    // UTF8è½¬Base64
    function utf8ToBase64(str) {
      try {
        if (window.TextEncoder) {
          const encoder = new TextEncoder('utf-8');
          const bytes = encoder.encode(str);
          let binary = '';
          for (let i = 0; i < bytes.length; i++) {
            binary += String.fromCharCode(bytes[i]);
          }
          return btoa(binary);
        } else {
          return btoa(unescape(encodeURIComponent(str)));
        }
      } catch (e) {
        return btoa(unescape(encodeURIComponent(str)));
      }
    }

    // Base64è½¬UTF8
    function base64ToUtf8(base64Str) {
      try {
        if (window.TextDecoder) {
          const binary = atob(base64Str);
          const bytes = new Uint8Array(binary.length);
          for (let i = 0; i < binary.length; i++) {
            bytes[i] = binary.charCodeAt(i);
          }
          const decoder = new TextDecoder('utf-8');
          return decoder.decode(bytes);
        } else {
          return decodeURIComponent(escape(atob(base64Str)));
        }
      } catch (e) {
        return decodeURIComponent(escape(atob(base64Str)));
      }
    }

    // ä¿å­˜GitHubé…ç½®
    function saveGithubConfig() {
      const token = el.githubToken.value.trim();
      const owner = el.githubOwner.value.trim() || 'xgd1062';
      const repo = el.githubRepo.value.trim() || '1062';
      const path = el.githubPath.value.trim() || '000/10 ä¹¦ç­¾é¡µ-bookmarks.html';

      let valid = true;

      if (!token) { el.tokenError.style.display = 'block'; valid = false; } else { el.tokenError.style.display = 'none'; }
      if (!owner) { el.ownerError.style.display = 'block'; valid = false; } else { el.ownerError.style.display = 'none'; }
      if (!repo) { el.repoError.style.display = 'block'; valid = false; } else { el.repoError.style.display = 'none'; }
      if (!path) { el.pathError.style.display = 'block'; valid = false; } else { el.pathError.style.display = 'none'; }

      if (!valid) return;

      githubConfig = { token, owner, repo, path };
      localStorage.setItem(GITHUB_CONFIG_KEY, JSON.stringify(githubConfig));
      syncFailCount = 0;
      localStorage.setItem(SYNC_FAIL_COUNT_KEY, '0');

      closeGithubConfigModal();
      showNotify('GitHubé…ç½®ä¿å­˜æˆåŠŸï¼Œå³å°†å¼€å§‹åŒæ­¥');

      setTimeout(() => { syncWithGitHub(); }, 1000);
    }

    // æ¸…é™¤GitHubé…ç½®
    function clearGithubConfig() {
      githubConfig = null;
      syncFailCount = 0;
      localStorage.removeItem(GITHUB_CONFIG_KEY);
      localStorage.removeItem(SYNC_FAIL_COUNT_KEY);
    }

    // ä¸GitHubåŒæ­¥
    async function syncWithGitHub() {
      if (!githubConfig) { openGithubConfigModal(); return; }

      el.syncGithubBtn.classList.add('loading');
      el.syncGithubBtn.innerHTML = '<span class="icon">â³</span><span>åŒæ­¥ä¸­...</span>';
      showLoading();

      try {
        const parser = new DOMParser();

        // ä¸‹è½½GitHubä¸Šçš„ä¹¦ç­¾
        const remoteHtml = await fetchGithubFile();
        const remoteBookmarks = remoteHtml ? parseEdgeBookmarks(parser.parseFromString(remoteHtml, 'text/html')) : [];
        let importedCount = 0;
        let keepDestroyCount = 0;

        // åˆå¹¶é€»è¾‘
        bookmarks = bookmarks.map(localBookmark => {
          const matchedRemote = remoteBookmarks.find(remote =>
            remote.url.toLowerCase() === localBookmark.url.toLowerCase()
          );
          if (localBookmark.name.length > 10) {
            localBookmark.name = localBookmark.name.slice(0, 10) + 'â€¦';
          }
          if (matchedRemote) {
            return { ...localBookmark, destroyed: localBookmark.destroyed };
          }
          return localBookmark;
        });

        // å¯¼å…¥GitHubç‹¬æœ‰ä¹¦ç­¾
        remoteBookmarks.forEach(remoteBookmark => {
          if (remoteBookmark.name.length > 10) {
            remoteBookmark.name = remoteBookmark.name.slice(0, 10) + 'â€¦';
          }
          if (!existingBookmark(remoteBookmark.url)) {
            bookmarks.push({ ...remoteBookmark, destroyed: false });
            importedCount++;
          } else {
            const localMatched = bookmarks.find(local =>
              local.url.toLowerCase() === remoteBookmark.url.toLowerCase() && local.destroyed
            );
            if (localMatched) keepDestroyCount++;
          }
        });

        localStorage.setItem('bookmarks', JSON.stringify(bookmarks));

        // å¤„ç†å¾…åˆ é™¤é¡¹
        const destroyedCount = bookmarks.filter(bookmark => bookmark.destroyed).length;
        bookmarks = bookmarks.filter(bookmark => !bookmark.destroyed);

        // å¤„ç†å¾…åˆ é™¤åˆ†ç±»
        const deletedCategoryCount = pendingDeleteCategories.length;
        categories = categories.filter(cat => !pendingDeleteCategories.includes(cat));
        pendingDeleteCategories.forEach(catId => {
          delete categoryNames[catId];
        });
        pendingDeleteCategories = [];

        // ä¿å­˜æœ€ç»ˆç»“æœ
        localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
        localStorage.setItem('categories', JSON.stringify(categories));
        localStorage.setItem('categoryNames', JSON.stringify(categoryNames));
        localStorage.setItem('pendingDeleteCategories', JSON.stringify(pendingDeleteCategories));

        // ä¸Šä¼ åˆ°GitHub
        const localHtml = `<!DOCTYPE NETSCAPE-Bookmark-file-1>
<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=UTF-8">
<META HTTP-EQUIV="Content-Language" CONTENT="zh-CN">
<TITLE>Bookmarks</TITLE>
<H1>Bookmarks</H1>
<DL><p>
  ${buildEdgeFolderStructure()}
</DL><p>`;

        await updateGitHubFile(localHtml);

        syncFailCount = 0;
        localStorage.setItem(SYNC_FAIL_COUNT_KEY, '0');

        renderCats();
        renderBookmarks();

        let notifyMsg = `åŒæ­¥å®Œæˆï¼`;
        if (importedCount > 0) notifyMsg += ` æ–°å¢å¯¼å…¥ ${importedCount} ä¸ªä¹¦ç­¾`;
        if (keepDestroyCount > 0) notifyMsg += ` ä¿ç•™ ${keepDestroyCount} ä¸ªä¹¦ç­¾çš„é”€æ¯æ ‡è¯†`;
        if (destroyedCount > 0) notifyMsg += ` å·²åˆ é™¤ ${destroyedCount} ä¸ªå¾…é”€æ¯ä¹¦ç­¾`;
        if (deletedCategoryCount > 0) notifyMsg += ` å·²åˆ é™¤ ${deletedCategoryCount} ä¸ªå¾…åˆ é™¤åˆ†ç±»`;
        if (importedCount === 0 && keepDestroyCount === 0 && destroyedCount === 0 && deletedCategoryCount === 0) {
          notifyMsg += ` ä¹¦ç­¾æ— å˜åŒ–`;
        }

        showNotify(notifyMsg);

      } catch (error) {
        syncFailCount++;
        localStorage.setItem(SYNC_FAIL_COUNT_KEY, syncFailCount.toString());

        showNotify(`åŒæ­¥å¤±è´¥ï¼ˆ${syncFailCount}/3ï¼‰ï¼š${error.message}`, 'error');

        if (syncFailCount >= 3) {
          clearGithubConfig();
          showNotify('åŒæ­¥å¤±è´¥æ¬¡æ•°è¿‡å¤šï¼Œå·²æ¸…é™¤é…ç½®ï¼Œè¯·é‡æ–°è®¾ç½®', 'warning');
        }
      } finally {
        el.syncGithubBtn.classList.remove('loading');
        el.syncGithubBtn.innerHTML = '<span class="icon">ğŸ”„</span><span>åŒæ­¥GitHub</span>';
        hideLoading();
      }
    }

    // è·å–GitHubæ–‡ä»¶
    async function fetchGithubFile() {
      const { token, owner, repo, path } = githubConfig;
      const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;

      try {
        const response = await fetch(apiUrl, {
          headers: {
            'Authorization': `token ${token}`,
            'Accept': 'application/vnd.github.v3+json'
          }
        });

        if (response.status === 404) return null;

        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.message || `HTTPé”™è¯¯ï¼š${response.status}`);
        }

        const data = await response.json();
        return base64ToUtf8(data.content);
      } catch (error) {
        throw new Error(`ä¸‹è½½å¤±è´¥ï¼š${error.message}`);
      }
    }

    // æ›´æ–°GitHubæ–‡ä»¶
    async function updateGitHubFile(content) {
      const { token, owner, repo, path } = githubConfig;
      const apiUrl = `https://api.github.com/repos/${owner}/${repo}/contents/${path}`;

      try {
        let sha = '';
        const shaResponse = await fetch(apiUrl, {
          headers: {
            'Authorization': `token ${token}`,
            'Accept': 'application/vnd.github.v3+json'
          }
        });

        if (shaResponse.ok) {
          const shaData = await shaResponse.json();
          sha = shaData.sha;
        }

        const response = await fetch(apiUrl, {
          method: 'PUT',
          headers: {
            'Authorization': `token ${token}`,
            'Accept': 'application/vnd.github.v3+json',
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({
            message: `Update bookmarks (${new Date().toLocaleString()})`,
            content: utf8ToBase64(content),
            sha: sha
          })
        });

        if (!response.ok) {
          const error = await response.json();
          throw new Error(error.message || `HTTPé”™è¯¯ï¼š${response.status}`);
        }

        return true;
      } catch (error) {
        throw new Error(`ä¸Šä¼ å¤±è´¥ï¼š${error.message}`);
      }
    }

    // æ£€æŸ¥ä¹¦ç­¾æ˜¯å¦å·²å­˜åœ¨
    function existingBookmark(url) {
      return bookmarks.some(b => b.url.toLowerCase() === url.toLowerCase());
    }

    // æ˜¾ç¤ºé€šçŸ¥
    function showNotify(message, type = 'success') {
      el.notificationMessage.textContent = message;
      el.notification.className = 'notification';
      el.notification.classList.add('show');
      el.notification.classList.add(`notification-${type}`);

      switch (type) {
        case 'success': el.notificationIcon.textContent = 'âœ“'; break;
        case 'error': el.notificationIcon.textContent = 'Ã—'; break;
        case 'warning': el.notificationIcon.textContent = 'âš ï¸'; break;
      }

      setTimeout(() => { el.notification.classList.remove('show'); }, 3000);
    }

    // æ˜¾ç¤ºåŠ è½½çŠ¶æ€
    function showLoading() {
      el.emptyState.classList.add('hidden');
      el.loadingState.classList.remove('hidden');
    }

    // éšè—åŠ è½½çŠ¶æ€
    function hideLoading() {
      el.loadingState.classList.add('hidden');
    }
  </script>
</body>

</html>