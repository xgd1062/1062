<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¿«é€Ÿæ”¯å‡ºè®°è´¦æœ¬ - å½“æ—¥æ±‡æ€»ç‰ˆ</title>
    <style>
        :root {
            --primary-color: #3f51b5;
            /* Indigo */
            --secondary-color: #f44336;
            /* Red (Expense) */
            --danger-color: #dc3545;
            /* Darker Red for delete button */
            --bg-light: #f7f9fc;
            --card-bg: #ffffff;
            --text-color: #333;
            --shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }

        * {
            box-sizing: border-box;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif, "Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol";
        }

        body {
            max-width: 600px;
            margin: 0 auto;
            padding: 15px;
            background-color: var(--bg-light);
            color: var(--text-color);
        }

        /* Header */
        header {
            text-align: center;
            padding: 15px 0 20px;
            border-bottom: 2px solid #eee;
        }

        header h1 {
            color: var(--primary-color);
            font-size: 1.8em;
            margin-bottom: 5px;
        }

        #current-datetime {
            font-size: 0.9em;
            color: #6c757d;
        }

        /* Daily Summary Box (Moved to bottom) */
        #daily-summary {
            background-color: var(--secondary-color);
            color: white;
            padding: 15px 20px;
            /* NEW: è°ƒæ•´ä¸Šè¾¹è·ï¼Œä¸å†å²åˆ—è¡¨ä¿æŒè·ç¦» */
            margin-top: 30px; 
            margin-bottom: 20px; 
            border-radius: 12px;
            box-shadow: var(--shadow);
            text-align: center;
        }

        #daily-summary h3 {
            margin: 0 0 5px 0;
            font-size: 1.1em;
            opacity: 0.8;
        }

        #daily-total {
            font-size: 2.2em;
            font-weight: bold;
        }


        /* Input Form */
        .input-card {
            background-color: var(--card-bg);
            padding: 20px;
            /* Adjusted margin */
            margin-top: 20px; 
            border-radius: 12px;
            box-shadow: var(--shadow);
        }

        #quick-entry-input {
            width: 100%;
            padding: 15px;
            font-size: 1.2em;
            border: 2px solid #ccc;
            border-radius: 8px;
            margin-bottom: 10px;
            resize: none;
            transition: border-color 0.3s;
        }

        #quick-entry-input:focus {
            border-color: var(--primary-color);
            outline: none;
        }

        #submit-btn {
            width: 100%;
            padding: 12px;
            font-size: 1.1em;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s;
        }

        #submit-btn:hover {
            background-color: #303f9f;
        }

        /* Preview */
        #preview-box {
            margin-top: 15px;
            padding: 10px;
            background-color: #ffebee;
            /* Light red background for preview */
            border-radius: 8px;
            font-size: 0.9em;
            line-height: 1.5;
            color: var(--secondary-color);
            min-height: 40px;
        }

        #preview-box strong {
            color: var(--secondary-color);
        }

        /* History List */
        .history-section {
            /* Adjusted margin to be consistent */
            margin-top: 30px; 
        }

        .history-section h2 {
            font-size: 1.4em;
            color: var(--text-color);
            border-bottom: 2px dashed #ddd;
            padding-bottom: 8px;
            margin-bottom: 15px;
        }

        #entries-list {
            list-style: none;
            padding: 0;
        }

        .entry-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            margin-bottom: 8px;
            background-color: var(--card-bg);
            border-left: 5px solid var(--secondary-color);
            border-radius: 8px;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .entry-description {
            flex-grow: 1;
        }

        .entry-description .desc-text {
            font-weight: 500;
        }

        .entry-description .desc-time {
            display: block;
            font-size: 0.8em;
            color: #999;
        }

        /* ç»Ÿä¸€åŠ¨ä½œå’Œé‡‘é¢åŒºåŸŸ */
        .entry-actions {
            display: flex;
            align-items: center;
            gap: 10px;
            min-width: 120px;
            justify-content: flex-end;
        }

        .entry-amount {
            font-weight: bold;
            font-size: 1.1em;
            text-align: right;
            color: var(--secondary-color);
            flex-shrink: 0;
        }

        /* åˆ é™¤æŒ‰é’®æ ·å¼ */
        .delete-entry-btn {
            background: none;
            border: 1px solid var(--danger-color);
            color: var(--danger-color);
            padding: 4px 8px;
            font-size: 0.8em;
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s, color 0.2s;
            flex-shrink: 0;
        }

        .delete-entry-btn:hover {
            background-color: var(--danger-color);
            color: white;
        }
    </style>
</head>

<body>

    <header>
        <h1>ğŸ’¸ å¿«é€Ÿæ”¯å‡ºè®°è´¦</h1>
        <div id="current-datetime"></div>
    </header>

    <div class="input-card">
        <h2>è¾“å…¥ (æè¿° + é‡‘é¢)</h2>
        <form id="accounting-form">
            <input type="text" id="quick-entry-input" placeholder="ä¾‹å¦‚: ä¹°äº†å’–å•¡ 15" required autocomplete="off">

            <div id="preview-box">è¾“å…¥å†…å®¹åè‡ªåŠ¨è¯†åˆ«...</div>

            <button type="submit" id="submit-btn">è®°å½•å¹¶ä¿å­˜</button>
        </form>
    </div>

    <div class="history-section">
        <h2>è®°è´¦å†å² (æœ€è¿‘20æ¡)</h2>
        <ul id="entries-list">
            </ul>
    </div>
    
    <div id="daily-summary">
        <h3>ä»Šæ—¥æ€»æ”¯å‡ºï¼ˆ${currentDate}ï¼‰</h3>
        <div id="daily-total">ï¿¥0.00</div>
    </div>


    <script>
        const STORAGE_KEY = 'quickAccountingExpensesOnly';
        const inputElement = document.getElementById('quick-entry-input');
        const formElement = document.getElementById('accounting-form');
        const entriesList = document.getElementById('entries-list');
        const dateTimeElement = document.getElementById('current-datetime');
        const previewBox = document.getElementById('preview-box');
        const dailyTotalElement = document.getElementById('daily-total');

        let entries = [];

        /**
         * 1. æ—¶é—´å¤„ç†å‡½æ•°
         */
        function updateDateTime() {
            const now = new Date();
            const dateStr = now.toLocaleDateString('zh-CN', { year: 'numeric', month: '2-digit', day: '2-digit' });
            const timeStr = now.toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit', second: '2-digit' });
            dateTimeElement.textContent = `å½“å‰æ—¶é—´: ${dateStr} ${timeStr}`;
            
            // æ›´æ–°æ±‡æ€»æ¡†çš„æ—¥æœŸæ˜¾ç¤º
            const summaryHeader = document.querySelector('#daily-summary h3');
            if (summaryHeader) {
                summaryHeader.textContent = `ä»Šæ—¥æ€»æ”¯å‡ºï¼ˆ${dateStr}ï¼‰`;
            }
        }
        updateDateTime();
        setInterval(updateDateTime, 1000);

        /**
         * 2. æ ¸å¿ƒï¼šè§£æè¾“å…¥å†…å®¹ï¼Œè‡ªåŠ¨è¯†åˆ«é‡‘é¢å’Œæè¿°
         */
        function parseInput(input) {
            const text = input.trim();
            // åŒ¹é…æ•°å­— (æ•´æ•°æˆ–å°æ•°)
            const amountRegex = /(\d+(\.\d{1,2})?)/;
            
            const match = text.match(amountRegex);
            let amount = 0;
            let description = text;

            if (match) {
                // æå–é‡‘é¢å­—ç¬¦ä¸²å¹¶è§£æä¸ºæµ®ç‚¹æ•°
                const amountStr = match[1]; 
                amount = parseFloat(amountStr);

                // ç§»é™¤é‡‘é¢éƒ¨åˆ†ï¼Œå‰©ä¸‹çš„ä½œä¸ºæè¿°
                description = text.replace(match[0], '').trim();
            }
            
            // å¦‚æœæè¿°ä¸ºç©ºï¼Œä½¿ç”¨å»é™¤é‡‘é¢åçš„åŸå§‹æ–‡æœ¬ï¼Œå¦åˆ™ä½¿ç”¨'æœªå‘½åè®°å½•'
            if (description === "") {
                 const tempDesc = text.replace(match ? match[0] : '', '').trim();
                 description = tempDesc || 'æœªå‘½åè®°å½•';
            }

            // å¼ºåˆ¶å°†é‡‘é¢è½¬æ¢ä¸ºè´Ÿæ•°ï¼ˆæ”¯å‡ºï¼‰
            if (amount > 0) {
                amount = -amount;
            } else if (amount === 0) {
                 if (text !== '') {
                    description = text; // å³ä½¿é‡‘é¢ä¸º0ï¼Œä¹Ÿä¿ç•™æè¿°
                 }
            }

            return {
                amount: amount,
                description: description
            };
        }

        /**
         * 3. æ•°æ®å­˜å‚¨å’ŒåŠ è½½
         */
        function loadEntries() {
            const stored = localStorage.getItem(STORAGE_KEY);
            if (stored) {
                entries = JSON.parse(stored);
            }
        }

        function saveEntries() {
            localStorage.setItem(STORAGE_KEY, JSON.stringify(entries));
        }
        
        /**
         * 4. è®¡ç®—å¹¶æ¸²æŸ“å½“æ—¥æ€»æ”¯å‡º
         */
        function calculateDailyTotal() {
            // è·å–ä»Šå¤©çš„æ—¥æœŸå­—ç¬¦ä¸² (ä»…å¹´æœˆæ—¥)
            const todayDateStr = new Date().toLocaleDateString('zh-CN', { year: 'numeric', month: '2-digit', day: '2-digit' });
            let dailyTotal = 0;

            entries.forEach(entry => {
                const entryDate = new Date(entry.timestamp).toLocaleDateString('zh-CN', { year: 'numeric', month: '2-digit', day: '2-digit' });
                
                // æ£€æŸ¥æ˜¯å¦ä¸ºä»Šæ—¥è®°å½•
                if (entryDate === todayDateStr) {
                    dailyTotal += entry.amount;
                }
            });

            // dailyTotal æ˜¯è´Ÿæ•°ï¼Œæ˜¾ç¤ºæ—¶å–ç»å¯¹å€¼
            dailyTotalElement.textContent = `ï¿¥${Math.abs(dailyTotal).toFixed(2)}`;
        }


        /**
         * 5. æ¸²æŸ“è®°è´¦åˆ—è¡¨ (æ–°å¢äº†åˆ é™¤æŒ‰é’®)
         */
        function renderEntries() {
            entriesList.innerHTML = '';
            
            // æ¯æ¬¡æ¸²æŸ“å‰éƒ½é‡æ–°è®¡ç®—æ€»é¢
            calculateDailyTotal();

            let itemRenderedCount = 0;
            
            // éå†æ•´ä¸ª entries æ•°ç»„ï¼Œä½¿ç”¨å…¶åŸå§‹ index
            entries.forEach((entry, originalIndex) => {
                if (itemRenderedCount >= 20) return; // åªæ¸²æŸ“å‰ 20 æ¡

                const item = document.createElement('li');
                
                item.className = 'entry-item expense';
                
                const displayAmount = Math.abs(entry.amount).toFixed(2);
                
                // æ ¼å¼åŒ–æ—¶é—´ (åªæ˜¾ç¤ºæ—¶åˆ†ç§’)
                const timeOnly = new Date(entry.timestamp).toLocaleTimeString('zh-CN', { hour: '2-digit', minute: '2-digit', second: '2-digit' });

                item.innerHTML = `
                    <div class="entry-description">
                        <span class="desc-text">${entry.description}</span>
                        <span class="desc-time">${timeOnly}</span>
                    </div>
                    <div class="entry-actions">
                        <div class="entry-amount">
                            -ï¿¥${displayAmount}
                        </div>
                        <button class="delete-entry-btn" data-index="${originalIndex}">åˆ é™¤</button>
                    </div>
                `;

                entriesList.appendChild(item);
                itemRenderedCount++;
            });
            
            if (entries.length > 20) {
                 const footer = document.createElement('div');
                 footer.style.textAlign = 'center';
                 footer.style.color = '#999';
                 footer.style.padding = '10px 0';
                 footer.textContent = `... å·²éšè—è¾ƒæ—©çš„ ${entries.length - 20} æ¡è®°å½•`;
                 entriesList.appendChild(footer);
            }

            if (entries.length === 0) {
                entriesList.innerHTML = '<p style="text-align:center; color:#999;">æš‚æ— è®°å½•</p>';
            }
        }

        /**
         * 6. äº‹ä»¶å¤„ç†ï¼šè¾“å…¥æ¡†å˜åŒ–æ—¶æ›´æ–°é¢„è§ˆ
         */
        inputElement.addEventListener('input', () => {
            const input = inputElement.value;
            if (input.trim() === '') {
                previewBox.innerHTML = 'è¾“å…¥å†…å®¹åè‡ªåŠ¨è¯†åˆ«...';
                return;
            }

            const parsed = parseInput(input);
            const amountText = 'æ”¯å‡º'; 
            const displayAmount = Math.abs(parsed.amount).toFixed(2);

            previewBox.innerHTML = `
                <p style="margin: 0;">
                    <strong>æè¿°:</strong> ${parsed.description}<br>
                    <strong>é‡‘é¢:</strong> <span style="color: var(--secondary-color);">${amountText} ï¿¥${displayAmount}</span>
                </p>
            `;
        });
        
        inputElement.dispatchEvent(new Event('input')); 


        /**
         * 7. äº‹ä»¶å¤„ç†ï¼šè¡¨å•æäº¤
         */
        formElement.addEventListener('submit', (e) => {
            e.preventDefault();

            const input = inputElement.value;
            if (input.trim() === '') {
                alert('è¯·è¾“å…¥å†…å®¹ï¼');
                return;
            }

            const parsed = parseInput(input);
            
            if (parsed.amount === 0 && input.trim() !== parsed.description) {
                if (input.match(/\d/)) {
                     // åŒ…å«æ•°å­—ä½†é‡‘é¢ä¸º0ï¼Œå…è®¸ï¼ˆè®°0å…ƒæ”¯å‡ºï¼‰
                } else {
                    alert('æœªè¯†åˆ«åˆ°æœ‰æ•ˆé‡‘é¢ï¼Œè¯·ç¡®ä¿è¾“å…¥ä¸­åŒ…å«æ•°å­—ï¼');
                    return;
                }
            }


            const newEntry = {
                description: parsed.description,
                amount: parsed.amount, 
                timestamp: new Date().toISOString()
            };

            // å°†æ–°è®°å½•æ·»åŠ åˆ°æœ€å‰é¢ (æœ€æ–°çš„åœ¨æœ€ä¸Šé¢)
            entries.unshift(newEntry);
            saveEntries();
            renderEntries(); // é‡æ–°æ¸²æŸ“åˆ—è¡¨å’Œæ€»é¢

            // æ¸…ç©ºè¾“å…¥æ¡†å¹¶é‡ç½®é¢„è§ˆ
            inputElement.value = '';
            inputElement.dispatchEvent(new Event('input')); 
        });


        /**
         * 8. äº‹ä»¶ä»£ç†å¤„ç†åˆ é™¤æŒ‰é’®ç‚¹å‡»
         */
        entriesList.addEventListener('click', (e) => {
            const target = e.target;
            
            if (target.classList.contains('delete-entry-btn')) {
                const index = parseInt(target.getAttribute('data-index'));
                
                if (isNaN(index) || index < 0 || index >= entries.length) {
                    console.error("Invalid entry index for deletion.");
                    return;
                }
                
                // ç¡®è®¤åˆ é™¤
                if (confirm(`ç¡®å®šè¦åˆ é™¤è®°å½•: "${entries[index].description} ï¿¥${Math.abs(entries[index].amount).toFixed(2)}" å—?`)) {
                    // ä½¿ç”¨ splice æ–¹æ³•åˆ é™¤æ•°ç»„ä¸­çš„å…ƒç´ 
                    entries.splice(index, 1);
                    
                    saveEntries();
                    renderEntries(); // é‡æ–°æ¸²æŸ“åˆ—è¡¨å’Œæ€»é¢
                }
            }
        });

        // 9. åˆå§‹åŒ–
        loadEntries();
        renderEntries();

    </script>

</body>

</html>