<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GitHub 内容上传器</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdn.jsdelivr.net/npm/font-awesome@4.7.0/css/font-awesome.min.css" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#2563eb',
                        secondary: '#10b981',
                        danger: '#ef4444',
                        github: '#171515'
                    },
                    fontFamily: {
                        sans: ['Inter', 'system-ui', 'sans-serif'],
                    },
                }
            }
        }
    </script>
    <style type="text/tailwindcss">
        @layer utilities {
            .content-auto {
                content-visibility: auto;
            }
            .transition-custom {
                transition: all 0.3s ease;
            }
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="container mx-auto px-4 py-8 max-w-3xl">
        <header class="text-center mb-10">
            <div class="inline-flex items-center justify-center p-3 bg-github text-white rounded-full mb-4">
                <i class="fa fa-github text-3xl"></i>
            </div>
            <h1 class="text-[clamp(1.8rem,5vw,2.5rem)] font-bold text-gray-800 mb-2">GitHub 内容上传器</h1>
            <p class="text-gray-600">轻松将内容直接上传到您的 GitHub 仓库</p>
        </header>

        <div class="bg-white rounded-xl shadow-lg p-6 md:p-8 mb-8 transform hover:shadow-xl transition-custom">
            <form id="githubUploadForm" class="space-y-6">
                <div>
                    <label for="githubToken" class="block text-sm font-medium text-gray-700 mb-1">GitHub 个人访问令牌</label>
                    <input type="password" id="githubToken" 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-custom"
                           placeholder="ghp_..." required>
                    <p class="mt-1 text-xs text-gray-500">
                        需要拥有 repo 权限的个人访问令牌。<a href="https://github.com/settings/tokens/new" target="_blank" class="text-primary hover:underline">创建令牌</a>
                    </p>
                </div>

                <div>
                    <label for="githubUsername" class="block text-sm font-medium text-gray-700 mb-1">GitHub 用户名</label>
                    <input type="text" id="githubUsername" 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-custom"
                           placeholder="您的GitHub用户名" required>
                </div>

                <div>
                    <label for="githubRepo" class="block text-sm font-medium text-gray-700 mb-1">仓库名称</label>
                    <input type="text" id="githubRepo" 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-custom"
                           placeholder="要上传的仓库名称" required>
                </div>

                <div>
                    <label for="filePath" class="block text-sm font-medium text-gray-700 mb-1">文件路径</label>
                    <input type="text" id="filePath" 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-custom"
                           placeholder="例如: docs/note.txt" required>
                </div>

                <div>
                    <label for="commitMessage" class="block text-sm font-medium text-gray-700 mb-1">提交信息</label>
                    <input type="text" id="commitMessage" 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-custom"
                           placeholder="描述您的更改" required>
                </div>

                <div>
                    <label for="content" class="block text-sm font-medium text-gray-700 mb-1">内容</label>
                    <textarea id="content" rows="8" 
                           class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-primary focus:border-primary transition-custom resize-none"
                           placeholder="输入要上传的内容..." required></textarea>
                </div>

                <button type="submit" id="submitBtn" 
                        class="w-full bg-primary hover:bg-primary/90 text-white font-medium py-3 px-4 rounded-lg transition-custom flex items-center justify-center gap-2">
                    <i class="fa fa-upload"></i>
                    <span>上传到 GitHub</span>
                </button>
            </form>
        </div>

        <div id="message" class="hidden p-4 rounded-lg mb-6"></div>

        <footer class="text-center text-gray-500 text-sm">
            <p>使用 GitHub API 构建 | <a href="https://docs.github.com/cn/rest" target="_blank" class="hover:text-primary transition-custom">查看 API 文档</a></p>
        </footer>
    </div>

    <script>
        // 设置默认值 - 请根据您的实际信息修改这些值
        const DEFAULT_VALUES = {
            githubUsername: "XGD1062",  // 替换为您的GitHub用户名
            githubRepo: "1062",            // 替换为您的仓库名称
            filePath: "信息.txt",      // 默认文件路径
            commitMessage: "更新内容",               // 默认提交信息
            // 建议不要在这里设置token，出于安全考虑
            // content: "这是默认内容"                // 可选：设置默认内容
        };

        // 页面加载完成后设置默认值
        document.addEventListener('DOMContentLoaded', function() {
            // 为每个字段设置默认值
            Object.keys(DEFAULT_VALUES).forEach(key => {
                const element = document.getElementById(key);
                if (element) {
                    element.value = DEFAULT_VALUES[key];
                }
            });
        });

        document.getElementById('githubUploadForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const submitBtn = document.getElementById('submitBtn');
            const messageDiv = document.getElementById('message');
            
            // 获取表单数据
            const token = document.getElementById('githubToken').value;
            const username = document.getElementById('githubUsername').value;
            const repo = document.getElementById('githubRepo').value;
            const filePath = document.getElementById('filePath').value;
            const commitMessage = document.getElementById('commitMessage').value;
            const content = document.getElementById('content').value;
            
            // 显示加载状态
            submitBtn.disabled = true;
            submitBtn.innerHTML = '<i class="fa fa-spinner fa-spin"></i><span>上传中...</span>';
            
            // 重置消息区域
            messageDiv.classList.add('hidden');
            
            try {
                // 首先检查文件是否存在
                const fileUrl = `https://api.github.com/repos/${username}/${repo}/contents/${filePath}`;
                
                let sha = null;
                try {
                    // 尝试获取文件信息（主要是为了获取sha值用于更新）
                    const checkResponse = await fetch(fileUrl, {
                        method: 'GET',
                        headers: {
                            'Authorization': `token ${token}`,
                            'Accept': 'application/vnd.github.v3+json'
                        }
                    });
                    
                    if (checkResponse.ok) {
                        const fileData = await checkResponse.json();
                        sha = fileData.sha; // 如果文件存在，获取其sha值
                    }
                } catch (error) {
                    // 文件不存在时会抛出404错误，这里忽略继续执行创建操作
                    console.log('文件不存在，将创建新文件');
                }
                
                // 准备上传数据
                const base64Content = btoa(unescape(encodeURIComponent(content)));
                const payload = {
                    message: commitMessage,
                    content: base64Content
                };
                
                // 如果文件存在，添加sha值用于更新
                if (sha) {
                    payload.sha = sha;
                }
                
                // 发送请求
                const response = await fetch(fileUrl, {
                    method: sha ? 'PUT' : 'PUT', // 创建和更新都使用PUT方法，区别在于是否提供sha
                    headers: {
                        'Authorization': `token ${token}`,
                        'Content-Type': 'application/json',
                        'Accept': 'application/vnd.github.v3+json'
                    },
                    body: JSON.stringify(payload)
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    // 显示成功消息
                    messageDiv.classList.remove('hidden', 'bg-red-100', 'text-danger');
                    messageDiv.classList.add('bg-green-100', 'text-green-800');
                    messageDiv.innerHTML = `
                        <div class="flex items-center">
                            <i class="fa fa-check-circle text-secondary mr-2"></i>
                            <div>
                                <p class="font-medium">上传成功！</p>
                                <p class="text-sm mt-1">
                                    可以查看: <a href="${result.content.html_url}" target="_blank" class="text-primary hover:underline">${result.content.html_url}</a>
                                </p>
                            </div>
                        </div>
                    `;
                } else {
                    // 显示错误消息
                    throw new Error(result.message || '上传失败，请检查您的信息');
                }
            } catch (error) {
                messageDiv.classList.remove('hidden', 'bg-green-100', 'text-green-800');
                messageDiv.classList.add('bg-red-100', 'text-danger');
                messageDiv.innerHTML = `
                    <div class="flex items-center">
                        <i class="fa fa-exclamation-circle mr-2"></i>
                        <div>
                            <p class="font-medium">上传失败</p>
                            <p class="text-sm mt-1">${error.message}</p>
                        </div>
                    </div>
                `;
                console.error('错误:', error);
            } finally {
                // 恢复按钮状态
                submitBtn.disabled = false;
                submitBtn.innerHTML = '<i class="fa fa-upload"></i><span>上传到 GitHub</span>';
            }
        });
    </script>
</body>
</html>
